<!DOCTYPE html><html lang="en"><head><meta charSet="utf-8"/><meta http-equiv="X-UA-Compatible" content="IE=edge"/><title>Caching · The Apollos Project</title><meta name="viewport" content="width=device-width"/><meta name="generator" content="Docusaurus"/><meta name="description" content="This guide describes how caching works in Apollos."/><meta name="docsearch:language" content="en"/><meta property="og:title" content="Caching · The Apollos Project"/><meta property="og:type" content="website"/><meta property="og:url" content="https://apollosapp.io/"/><meta property="og:description" content="This guide describes how caching works in Apollos."/><meta property="og:image" content="https://apollosapp.io/img/apollos.png"/><meta name="twitter:card" content="summary"/><meta name="twitter:image" content="https://apollosapp.io/img/apollos.png"/><link rel="shortcut icon" href="/img/favicon.png"/><link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/styles/default.min.css"/><link rel="alternate" type="application/atom+xml" href="https://apollosapp.io/blog/atom.xml" title="The Apollos Project Blog ATOM Feed"/><link rel="alternate" type="application/rss+xml" href="https://apollosapp.io/blog/feed.xml" title="The Apollos Project Blog RSS Feed"/><script src="/js/scrollSpy.js"></script><link rel="stylesheet" href="/css/main.css"/><script src="/js/codetabs.js"></script></head><body class="sideNavVisible separateOnPageNav"><div class="fixedHeaderContainer"><div class="headerWrapper wrapper"><header><a href="/"><img class="logo" src="/img/brand/wordmark.png" alt="The Apollos Project"/></a><div class="navigationWrapper navigationSlider"><nav class="slidingNav"><ul class="nav-site nav-site-internal"><li class="siteNavGroupActive"><a href="/docs/install" target="_self">Docs</a></li><li class=""><a href="/help" target="_self">Help</a></li><li class=""><a href="/blog/" target="_self">Blog</a></li></ul></nav></div></header></div></div><div class="navPusher"><div class="docMainWrapper wrapper"><div class="docsNavContainer" id="docsNav"><nav class="toc"><div class="toggleNav"><section class="navWrapper wrapper"><div class="navBreadcrumb wrapper"><div class="navToggle" id="navToggler"><div class="hamburger-menu"><div class="line1"></div><div class="line2"></div><div class="line3"></div></div></div><h2><i>›</i><span>Guides</span></h2><div class="tocToggler" id="tocToggler"><i class="icon-toc"></i></div></div><div class="navGroups"><div class="navGroup"><h3 class="navGroupCategoryTitle">Getting Started</h3><ul class=""><li class="navListItem"><a class="navItem" href="/docs/install">Installation</a></li></ul></div><div class="navGroup"><h3 class="navGroupCategoryTitle">Guides</h3><ul class=""><li class="navListItem"><a class="navItem" href="/docs/contributing">Contributing</a></li><li class="navListItem"><a class="navItem" href="/docs/fastly">Setting Up Fastly CDN</a></li><li class="navListItem"><a class="navItem" href="/docs/passkit">Apple PassKit</a></li><li class="navListItem"><a class="navItem" href="/docs/weekend-experience">Implementing the Weekend Experience</a></li><li class="navListItem"><a class="navItem" href="/docs/prayer">Prayer</a></li><li class="navListItem"><a class="navItem" href="/docs/performance">Performance</a></li><li class="navListItem"><a class="navItem" href="/docs/load-testing">Load Testing</a></li><li class="navListItem"><a class="navItem" href="/docs/send-push">Sending a Push Message</a></li><li class="navListItem"><a class="navItem" href="/docs/search">Search</a></li><li class="navListItem"><a class="navItem" href="/docs/terraform">Terraform</a></li><li class="navListItem navListItemActive"><a class="navItem" href="/docs/caching">Caching</a></li></ul></div><div class="navGroup"><h3 class="navGroupCategoryTitle">Rock Integration</h3><ul class=""><li class="navListItem"><a class="navItem" href="/docs/rock-setup">Rock Setup</a></li><li class="navListItem"><a class="navItem" href="/docs/one-signal">OneSignal Push Notifications</a></li><li class="navListItem"><a class="navItem" href="/docs/content-personalization">Content Personalization</a></li></ul></div><div class="navGroup"><h3 class="navGroupCategoryTitle">UI-Kit</h3><ul class=""><li class="navListItem"><a class="navItem" href="/docs/ui-kit/actionbaritem">ActionBarItem</a></li><li class="navListItem"><a class="navItem" href="/docs/ui-kit/actionbar">ActionBar</a></li><li class="navListItem"><a class="navItem" href="/docs/ui-kit/actioncard">ActionCard</a></li><li class="navListItem"><a class="navItem" href="/docs/ui-kit/actionlist">ActionList</a></li><li class="navListItem"><a class="navItem" href="/docs/ui-kit/actionlistimage">ActionListImage</a></li><li class="navListItem"><a class="navItem" href="/docs/ui-kit/actionlistitem">ActionListItem</a></li><li class="navListItem"><a class="navItem" href="/docs/ui-kit/actionlistcard">ActionListCard</a></li><li class="navListItem"><a class="navItem" href="/docs/ui-kit/avatarcloud">AvatarCloud</a></li><li class="navListItem"><a class="navItem" href="/docs/ui-kit/touchableavatar">TouchableAvatar</a></li><li class="navListItem"><a class="navItem" href="/docs/ui-kit/avatarlist">AvatarList</a></li><li class="navListItem"><a class="navItem" href="/docs/ui-kit/backgroundimageblur">BackgroundImageBlur</a></li><li class="navListItem"><a class="navItem" href="/docs/ui-kit/button">Button</a></li><li class="navListItem"><a class="navItem" href="/docs/ui-kit/buttonicon">ButtonIcon</a></li><li class="navListItem"><a class="navItem" href="/docs/ui-kit/campuscard">CampusCard</a></li><li class="navListItem"><a class="navItem" href="/docs/ui-kit/cardwrapper">CardWrapper</a></li><li class="navListItem"><a class="navItem" href="/docs/ui-kit/errorcard">ErrorCard</a></li><li class="navListItem"><a class="navItem" href="/docs/ui-kit/cardtile">CardTile</a></li><li class="navListItem"><a class="navItem" href="/docs/ui-kit/channellabel">ChannelLabel</a></li><li class="navListItem"><a class="navItem" href="/docs/ui-kit/chip">Chip</a></li><li class="navListItem"><a class="navItem" href="/docs/ui-kit/connectedimage">ConnectedImage</a></li><li class="navListItem"><a class="navItem" href="/docs/ui-kit/cardfooter">CardFooter</a></li><li class="navListItem"><a class="navItem" href="/docs/ui-kit/contenttext">ContentText</a></li><li class="navListItem"><a class="navItem" href="/docs/ui-kit/imageheader">ImageHeader</a></li><li class="navListItem"><a class="navItem" href="/docs/ui-kit/metrics">Metrics</a></li><li class="navListItem"><a class="navItem" href="/docs/ui-kit/textheader">TextHeader</a></li><li class="navListItem"><a class="navItem" href="/docs/ui-kit/contentcard">ContentCard</a></li><li class="navListItem"><a class="navItem" href="/docs/ui-kit/defaultcard">DefaultCard</a></li><li class="navListItem"><a class="navItem" href="/docs/ui-kit/featuredcard">FeaturedCard</a></li><li class="navListItem"><a class="navItem" href="/docs/ui-kit/feedview">FeedView</a></li><li class="navListItem"><a class="navItem" href="/docs/ui-kit/gradientoverlayimage">GradientOverlayImage</a></li><li class="navListItem"><a class="navItem" href="/docs/ui-kit/highlightcard">HighlightCard</a></li><li class="navListItem"><a class="navItem" href="/docs/ui-kit/horizontaldefaultcard">HorizontalDefaultCard</a></li><li class="navListItem"><a class="navItem" href="/docs/ui-kit/horizontalhighlightcard">HorizontalHighlightCard</a></li><li class="navListItem"><a class="navItem" href="/docs/ui-kit/icon">Icon</a></li><li class="navListItem"><a class="navItem" href="/docs/ui-kit/mediaquery">MediaQuery</a></li><li class="navListItem"><a class="navItem" href="/docs/ui-kit/mediathumbnail">MediaThumbnail</a></li><li class="navListItem"><a class="navItem" href="/docs/ui-kit/modalviewheader">ModalViewHeader</a></li><li class="navListItem"><a class="navItem" href="/docs/ui-kit/modalview">ModalView</a></li><li class="navListItem"><a class="navItem" href="/docs/ui-kit/overlaybackgroundimage">OverlayBackgroundImage</a></li><li class="navListItem"><a class="navItem" href="/docs/ui-kit/line">Line</a></li><li class="navListItem"><a class="navItem" href="/docs/ui-kit/media">Media</a></li><li class="navListItem"><a class="navItem" href="/docs/ui-kit/stretchy">Stretchy</a></li><li class="navListItem"><a class="navItem" href="/docs/ui-kit/indicator">Indicator</a></li><li class="navListItem"><a class="navItem" href="/docs/ui-kit/label">Label</a></li><li class="navListItem"><a class="navItem" href="/docs/ui-kit/cell">Cell</a></li><li class="navListItem"><a class="navItem" href="/docs/ui-kit/thumbnailcard">ThumbnailCard</a></li><li class="navListItem"><a class="navItem" href="/docs/ui-kit/tileimage">TileImage</a></li><li class="navListItem"><a class="navItem" href="/docs/ui-kit/touchable">Touchable</a></li><li class="navListItem"><a class="navItem" href="/docs/ui-kit/touchablescale">TouchableScale</a></li><li class="navListItem"><a class="navItem" href="/docs/ui-kit/dateinput">DateInput</a></li><li class="navListItem"><a class="navItem" href="/docs/ui-kit/floatinglabel">FloatingLabel</a></li><li class="navListItem"><a class="navItem" href="/docs/ui-kit/inputunderline">InputUnderline</a></li><li class="navListItem"><a class="navItem" href="/docs/ui-kit/pickerlist">PickerList</a></li><li class="navListItem"><a class="navItem" href="/docs/ui-kit/">Index</a></li><li class="navListItem"><a class="navItem" href="/docs/ui-kit/radio">Radio</a></li><li class="navListItem"><a class="navItem" href="/docs/ui-kit/radiobutton">RadioButton</a></li><li class="navListItem"><a class="navItem" href="/docs/ui-kit/radiobuttonindicator">RadioButtonIndicator</a></li><li class="navListItem"><a class="navItem" href="/docs/ui-kit/searchactions">SearchActions</a></li><li class="navListItem"><a class="navItem" href="/docs/ui-kit/switch">Switch</a></li><li class="navListItem"><a class="navItem" href="/docs/ui-kit/themeprovider">ThemeProvider</a></li><li class="navListItem"><a class="navItem" href="/docs/ui-kit/arrowback">ArrowBack</a></li><li class="navListItem"><a class="navItem" href="/docs/ui-kit/arrowdown">ArrowDown</a></li><li class="navListItem"><a class="navItem" href="/docs/ui-kit/arrownext">ArrowNext</a></li><li class="navListItem"><a class="navItem" href="/docs/ui-kit/arrowup">ArrowUp</a></li><li class="navListItem"><a class="navItem" href="/docs/ui-kit/audio">Audio</a></li><li class="navListItem"><a class="navItem" href="/docs/ui-kit/avatar">Avatar</a></li><li class="navListItem"><a class="navItem" href="/docs/ui-kit/badge">Badge</a></li><li class="navListItem"><a class="navItem" href="/docs/ui-kit/bank">Bank</a></li><li class="navListItem"><a class="navItem" href="/docs/ui-kit/brandicon">BrandIcon</a></li><li class="navListItem"><a class="navItem" href="/docs/ui-kit/building">Building</a></li><li class="navListItem"><a class="navItem" href="/docs/ui-kit/calendar">Calendar</a></li><li class="navListItem"><a class="navItem" href="/docs/ui-kit/camera">Camera</a></li><li class="navListItem"><a class="navItem" href="/docs/ui-kit/check">Check</a></li><li class="navListItem"><a class="navItem" href="/docs/ui-kit/checkboxchecked">CheckboxChecked</a></li><li class="navListItem"><a class="navItem" href="/docs/ui-kit/checkboxunchecked">CheckboxUnchecked</a></li><li class="navListItem"><a class="navItem" href="/docs/ui-kit/chromecast">Chromecast</a></li><li class="navListItem"><a class="navItem" href="/docs/ui-kit/circleoutlinecheckmark">CircleOutlineCheckMark</a></li><li class="navListItem"><a class="navItem" href="/docs/ui-kit/circleoutlineplus">CircleOutlinePlus</a></li><li class="navListItem"><a class="navItem" href="/docs/ui-kit/circleoutlinexmark">CircleOutlineXMark</a></li><li class="navListItem"><a class="navItem" href="/docs/ui-kit/close">Close</a></li><li class="navListItem"><a class="navItem" href="/docs/ui-kit/credit">Credit</a></li><li class="navListItem"><a class="navItem" href="/docs/ui-kit/download">Download</a></li><li class="navListItem"><a class="navItem" href="/docs/ui-kit/dropdown">Dropdown</a></li><li class="navListItem"><a class="navItem" href="/docs/ui-kit/empty">Empty</a></li><li class="navListItem"><a class="navItem" href="/docs/ui-kit/failed">Failed</a></li><li class="navListItem"><a class="navItem" href="/docs/ui-kit/filter">Filter</a></li><li class="navListItem"><a class="navItem" href="/docs/ui-kit/fullscreen">Fullscreen</a></li><li class="navListItem"><a class="navItem" href="/docs/ui-kit/groups">Groups</a></li><li class="navListItem"><a class="navItem" href="/docs/ui-kit/home">Home</a></li><li class="navListItem"><a class="navItem" href="/docs/ui-kit/information">Information</a></li><li class="navListItem"><a class="navItem" href="/docs/ui-kit/like">Like</a></li><li class="navListItem"><a class="navItem" href="/docs/ui-kit/likesolid">LikeSolid</a></li><li class="navListItem"><a class="navItem" href="/docs/ui-kit/livedot">LiveDot</a></li><li class="navListItem"><a class="navItem" href="/docs/ui-kit/locate">Locate</a></li><li class="navListItem"><a class="navItem" href="/docs/ui-kit/lock">Lock</a></li><li class="navListItem"><a class="navItem" href="/docs/ui-kit/mute">Mute</a></li><li class="navListItem"><a class="navItem" href="/docs/ui-kit/pause">Pause</a></li><li class="navListItem"><a class="navItem" href="/docs/ui-kit/pin">Pin</a></li><li class="navListItem"><a class="navItem" href="/docs/ui-kit/play">Play</a></li><li class="navListItem"><a class="navItem" href="/docs/ui-kit/playopaque">PlayOpaque</a></li><li class="navListItem"><a class="navItem" href="/docs/ui-kit/playsolid">PlaySolid</a></li><li class="navListItem"><a class="navItem" href="/docs/ui-kit/plus">Plus</a></li><li class="navListItem"><a class="navItem" href="/docs/ui-kit/pray">Pray</a></li><li class="navListItem"><a class="navItem" href="/docs/ui-kit/print">Print</a></li><li class="navListItem"><a class="navItem" href="/docs/ui-kit/profile">Profile</a></li><li class="navListItem"><a class="navItem" href="/docs/ui-kit/radiochecked">RadioChecked</a></li><li class="navListItem"><a class="navItem" href="/docs/ui-kit/radiounchecked">RadioUnchecked</a></li><li class="navListItem"><a class="navItem" href="/docs/ui-kit/repeat">Repeat</a></li><li class="navListItem"><a class="navItem" href="/docs/ui-kit/repeatall">RepeatAll</a></li><li class="navListItem"><a class="navItem" href="/docs/ui-kit/repeatone">RepeatOne</a></li><li class="navListItem"><a class="navItem" href="/docs/ui-kit/search">Search</a></li><li class="navListItem"><a class="navItem" href="/docs/ui-kit/sections">Sections</a></li><li class="navListItem"><a class="navItem" href="/docs/ui-kit/settings">Settings</a></li><li class="navListItem"><a class="navItem" href="/docs/ui-kit/share">Share</a></li><li class="navListItem"><a class="navItem" href="/docs/ui-kit/shuffle">Shuffle</a></li><li class="navListItem"><a class="navItem" href="/docs/ui-kit/skipbackthirty">SkipBackThirty</a></li><li class="navListItem"><a class="navItem" href="/docs/ui-kit/skipforwardthirty">SkipForwardThirty</a></li><li class="navListItem"><a class="navItem" href="/docs/ui-kit/skipnext">SkipNext</a></li><li class="navListItem"><a class="navItem" href="/docs/ui-kit/skipprevious">SkipPrevious</a></li><li class="navListItem"><a class="navItem" href="/docs/ui-kit/text">Text</a></li><li class="navListItem"><a class="navItem" href="/docs/ui-kit/time">Time</a></li><li class="navListItem"><a class="navItem" href="/docs/ui-kit/umbrella">Umbrella</a></li><li class="navListItem"><a class="navItem" href="/docs/ui-kit/video">Video</a></li><li class="navListItem"><a class="navItem" href="/docs/ui-kit/videooff">VideoOff</a></li><li class="navListItem"><a class="navItem" href="/docs/ui-kit/volume">Volume</a></li><li class="navListItem"><a class="navItem" href="/docs/ui-kit/warning">Warning</a></li><li class="navListItem"><a class="navItem" href="/docs/ui-kit/blockquote">BlockQuote</a></li><li class="navListItem"><a class="navItem" href="/docs/ui-kit/bulletlistitem">BulletListItem</a></li></ul></div></div></section></div><script>
            var coll = document.getElementsByClassName('collapsible');
            var checkActiveCategory = true;
            for (var i = 0; i < coll.length; i++) {
              var links = coll[i].nextElementSibling.getElementsByTagName('*');
              if (checkActiveCategory){
                for (var j = 0; j < links.length; j++) {
                  if (links[j].classList.contains('navListItemActive')){
                    coll[i].nextElementSibling.classList.toggle('hide');
                    coll[i].childNodes[1].classList.toggle('rotate');
                    checkActiveCategory = false;
                    break;
                  }
                }
              }

              coll[i].addEventListener('click', function() {
                var arrow = this.childNodes[1];
                arrow.classList.toggle('rotate');
                var content = this.nextElementSibling;
                content.classList.toggle('hide');
              });
            }

            document.addEventListener('DOMContentLoaded', function() {
              createToggler('#navToggler', '#docsNav', 'docsSliderActive');
              createToggler('#tocToggler', 'body', 'tocActive');

              var headings = document.querySelector('.toc-headings');
              headings && headings.addEventListener('click', function(event) {
                var el = event.target;
                while(el !== headings){
                  if (el.tagName === 'A') {
                    document.body.classList.remove('tocActive');
                    break;
                  } else{
                    el = el.parentNode;
                  }
                }
              }, false);

              function createToggler(togglerSelector, targetSelector, className) {
                var toggler = document.querySelector(togglerSelector);
                var target = document.querySelector(targetSelector);

                if (!toggler) {
                  return;
                }

                toggler.onclick = function(event) {
                  event.preventDefault();

                  target.classList.toggle(className);
                };
              }
            });
        </script></nav></div><div class="container mainContainer docsContainer"><div class="wrapper"><div class="post"><header class="postHeader"><h1 id="__docusaurus" class="postHeaderTitle">Caching</h1></header><article><div><span><p>This guide describes how caching works in Apollos.</p>
<h2><a class="anchor" aria-hidden="true" id="the-need-for-caching"></a><a href="#the-need-for-caching" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>The Need for Caching</h2>
<p>The Apollos App uses Rock as its primary source of data. For every request that is made to the Apollos API, a number of separate Requests are made to Rock. Because of this, as the latency to Rock increases (because of increased load on the Rock servers) we see an exaggerated impact on the response time of our API. In many cases, we don't have the option of reducing the number of requests we make to Rock, nor do we have any control over optimizing the speed of the Rock API. Thus, we need to reduce the number of requests we make to Rock by returning data we already have, as often as possible.</p>
<h2><a class="anchor" aria-hidden="true" id="caching-strategies"></a><a href="#caching-strategies" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Caching Strategies</h2>
<p>We implement three unique and specific layers of caching. Each layer serves a different role, and has different strengths and weaknesses. We'll try and cover them all here.</p>
<h3><a class="anchor" aria-hidden="true" id="fastly--graphql"></a><a href="#fastly--graphql" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Fastly / GraphQL</h3>
<h4><a class="anchor" aria-hidden="true" id="when-and-why"></a><a href="#when-and-why" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>When and Why?</h4>
<p>We use a feature of <code>ApolloServer</code> that allows you to annotate your schema with &quot;cache hints&quot;. Any request to our GraphQL server (that isn't a mutation) will be responded to with cache hints <strong>equal to the lowest cache hint for the entire request</strong>.</p>
<p>These cache hints are standard <a href="https://developers.google.com/web/fundamentals/performance/optimizing-content-efficiency/http-caching#max-age">HTTP Cache-Control headers</a>. Because these headers are set on a per-request level, instead of a per-field level, i you add a field to your request that is marked as uncachable, or with an extremely low max age, the entire request won't be cached.</p>
<p>Because of this, it's very important that as a client developer you pay attention to these hints in the schema. You could make a very performant API request very slow (and costly) by adding a single, uncachable field!</p>
<p>Uncachable fields tend to fall into two camps:</p>
<ul>
<li>Fields whose data is expected to change over time.</li>
<li>Fields which are personal to a specific user.</li>
</ul>
<p>The actual caching is achieved through <a href="https://www.fastly.com/">Fastly</a>. Fastly is <em>CDN</em> that all requests and responses to the GraphQL API pass through. Fastly pays attention to the max-age headers, and if a response includes a max-age header, it caches that request for the length of time in the header. If another identical request is recieved, Fastly returns the request it has stored instead of hitting the server. The Apollos server will actually never see the request.</p>
<p>As a &quot;Master Cacher&quot;, this should be your first line of defense. If you can add cache hints to your query, or modify your query so it doesn't include any uncachable fields, do it! This level of caching is the fastest for the end user, has zero cost on the server, and doesn't require any complex code changes.</p>
<h4><a class="anchor" aria-hidden="true" id="how"></a><a href="#how" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>How?</h4>
<p>Configuration needs to happen in two places.</p>
<p><code>ApolloServer</code> - You'll need to enable sending the maxAge headers on your API. This is enabled by default with the <code>ApollosServer</code>, but you can see more documentation <a href="https://www.apollographql.com/docs/apollo-server/api/apollo-server/#apolloserver">here</a>.</p>
<p><code>Schema Hints</code> - The Apollo API ships with some reasonable defaults around hints. However, for any new fields you add or new types you create, you'll want to change the maxAge using cacheHints to match your needs. The &quot;how&quot; can be found in the <a href="https://www.apollographql.com/docs/apollo-server/performance/caching/#defining-cache-hints">Apollo Docs</a></p>
<p><code>Fastly</code> - We have information on how to setup Fastly <a href="https://apollosapp.io/docs/fastly">here</a></p>
<h3><a class="anchor" aria-hidden="true" id="apollo-datasource-cache"></a><a href="#apollo-datasource-cache" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Apollo DataSource Cache</h3>
<h4><a class="anchor" aria-hidden="true" id="when-and-why-1"></a><a href="#when-and-why-1" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>When and Why?</h4>
<p>The Apollos DataSource Cache is a tool provided by the <a href="https://www.apollographql.com/docs/apollo-server/data/data-sources/#rest-data-source">Apollo Rest DataSource</a> This caching mechanism will cache the results of requests made by our rock data source methods, but only if you specify a <code>ttl</code> using the request builder. This cache will also cache the results of requests whose results include standard cache-control/max-age headers.</p>
<p>The results from this caching layer are all stored in server memory by default, but results can also be stored in <code>redis</code> or <code>memcached</code> with the right setup.</p>
<p>This cache source is useful in a few specific scenarios. It's nice when you know a specific resource will be fetched multiple times in a short span of time; it's useful to add granular caching to data that isn't cacheable through Fastly / GraphQL It's also useful if you are consuming an API that does return caching related headers. It's also a good caching option if you are already using the request builder, because it's a one line change to introduce caching However, this isn't a good caching option if you need data cached for a longer length of time, or if you need control over the data in the cache. For that, explore the next cache option.</p>
<h4><a class="anchor" aria-hidden="true" id="how-1"></a><a href="#how-1" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>How?</h4>
<p>To cache data when using the request builder, add a <code>.cache()</code> to the request chain you are building.</p>
<p>Example:</p>
<pre><code class="hljs"><span class="hljs-keyword">const</span> slug = <span class="hljs-keyword">await</span> <span class="hljs-keyword">this</span>.request(<span class="hljs-string">'ContentChannelItemSlugs'</span>)
  .filter(<span class="hljs-string">`ContentChannelItemId eq <span class="hljs-subst">${contentId}</span>`</span>)
  .cache({ <span class="hljs-attr">ttl</span>: <span class="hljs-number">60</span> })
  .first();
</code></pre>
<h3><a class="anchor" aria-hidden="true" id="custom-cache-datasource"></a><a href="#custom-cache-datasource" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Custom Cache DataSource</h3>
<h4><a class="anchor" aria-hidden="true" id="when-and-why-2"></a><a href="#when-and-why-2" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>When and Why?</h4>
<p>For more control, and to fill in the gaps in our caching strategy, we built a custom data source to cache with a high level of granularity. This cache source requires the most code of all the solutions to cache data, but the programmer has full control over the key the data is cached under, the data being cached, and the length that data is cached. This source can almost be considered a database for data that will be accessed frequently. Data is conveniently stored in Redis, so any data cached on one server will be available to all servers.</p>
<p>Use this data source if you know you need to cache data that is difficult to cache, and thus requires a lot of control to cache. You can also use this data source if you want to cache something, and then need to have control over the data potentially stored in the cache down the road (like liking content items).</p>
<h4><a class="anchor" aria-hidden="true" id="how-2"></a><a href="#how-2" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>How?</h4>
<p>If you are using the Apollos API in a &quot;out of the box&quot; setup, you'll have a <code>DataSource</code> called <code>Cache</code> included out of the box.</p>
<pre><code class="hljs">const { <span class="hljs-keyword">Cache</span> } = context.dataSources;

<span class="hljs-comment">// Gets a value, if it exists.</span>
<span class="hljs-keyword">Cache</span>.get({ key: <span class="hljs-built_in">String</span>|<span class="hljs-built_in">Array</span> })

<span class="hljs-comment">// Sets a value</span>
<span class="hljs-keyword">Cache</span>.<span class="hljs-built_in">set</span>({ key: <span class="hljs-built_in">String</span>|<span class="hljs-built_in">Array</span>, <span class="hljs-built_in">data</span>: (Any JSON serializable <span class="hljs-built_in">data</span>), expiresIn: (Seconds, optionally)  })

<span class="hljs-comment">// Increments a value by 1</span>
<span class="hljs-keyword">Cache</span>.increment({ key: <span class="hljs-built_in">String</span>|<span class="hljs-built_in">Array</span>  })

<span class="hljs-comment">// Decrements a value by 1</span>
<span class="hljs-keyword">Cache</span>.decrement({ key: <span class="hljs-built_in">String</span>|<span class="hljs-built_in">Array</span>  })
</code></pre>
</span></div></article></div><div class="docs-prevnext"><a class="docs-prev button" href="/docs/terraform"><span class="arrow-prev">← </span><span>Terraform</span></a><a class="docs-next button" href="/docs/rock-setup"><span>Rock Setup</span><span class="arrow-next"> →</span></a></div></div></div><nav class="onPageNav"><ul class="toc-headings"><li><a href="#the-need-for-caching">The Need for Caching</a></li><li><a href="#caching-strategies">Caching Strategies</a><ul class="toc-headings"><li><a href="#fastly--graphql">Fastly / GraphQL</a></li><li><a href="#apollo-datasource-cache">Apollo DataSource Cache</a></li><li><a href="#custom-cache-datasource">Custom Cache DataSource</a></li></ul></li></ul></nav></div><footer class="nav-footer" id="footer"><section class="sitemap"><a href="/" class="nav-home"><img src="/img/apollos.png" alt="The Apollos Project" width="66" height="58"/></a><div><h5>Docs</h5><a href="/docs/en/install.html">Getting Started</a><a href="/docs/en/contributing.html">Guides</a><a href="/docs/en/doc3.html">API Reference</a></div><div><h5>Community</h5><a href="/en/users.html">User Showcase</a><a href="http://stackoverflow.com/questions/tagged/" target="_blank" rel="noreferrer noopener">Stack Overflow</a><a href="https://discordapp.com/">Project Chat</a><a href="https://twitter.com/" target="_blank" rel="noreferrer noopener">Twitter</a></div><div><h5>More</h5><a href="/blog">Blog</a><a href="https://github.com/">GitHub</a><a class="github-button" data-icon="octicon-star" data-count-href="/facebook/docusaurus/stargazers" data-show-count="true" data-count-aria-label="# stargazers on GitHub" aria-label="Star this project on GitHub">Star</a></div></section><a href="https://code.facebook.com/projects/" target="_blank" rel="noreferrer noopener" class="fbOpenSource"><img src="/img/oss_logo.png" alt="Facebook Open Source" width="170" height="45"/></a><section class="copyright">Copyright © 2021 Apollos Project</section></footer></div></body></html>